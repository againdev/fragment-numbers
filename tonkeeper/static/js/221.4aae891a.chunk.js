"use strict";(self.webpackChunk_tonkeeper_extension=self.webpackChunk_tonkeeper_extension||[]).push([[221],{89221:(e,t,n)=>{n.r(t),n.d(t,{default:()=>q});var i=n(80184),r=n(14182),s=n(18203),a=n(72791),o=n(4959),l=n(73485),c=n(87594),u=n(23098),d=n(61945),h=n(89242),p=n(38705),f=n(80572),m=n(98502),x=n(27127),v=n(5784),g=n(26503),y=n(47712),w=n(68827),j=n(91153);const C=e=>{let{onBack:t,onClose:n}=e;return(0,i.jsxs)(h.hy,{children:[(0,i.jsx)(w.z,{onClick:t,children:(0,i.jsx)(v.wy,{})}),(0,i.jsx)(h.Ho,{handleClose:n})]})},b=e=>{let{nftItem:t}=e;const{t:n}=(0,d.$G)(),r=(0,u._H)(),s=(0,j.i7)();return(0,i.jsxs)(g.L8,{fullWidth:!0,children:[t.collection&&(0,i.jsx)(g.HC,{onClick:()=>r.copyToClipboard((0,x.Tg)(t.collection.address,s,!0)),children:(0,i.jsxs)(g.me,{children:[(0,i.jsx)(m.__,{children:n("NFT_collection_id")}),(0,i.jsx)(y.RV,{children:(0,x.FN)((0,x.Tg)(t.collection.address,s,!0))})]})}),(0,i.jsx)(g.HC,{onClick:()=>r.copyToClipboard((0,x.Tg)(t.address,s,!0)),children:(0,i.jsxs)(g.me,{children:[(0,i.jsx)(m.__,{children:n("NFT_item_id")}),(0,i.jsx)(y.RV,{children:(0,x.FN)((0,x.Tg)(t.address,s,!0))})]})})]})};var T,E=n(30168),_=n(41235),k=n(45928),A=n(24539),S=n(73643),W=n(76978),B=n(1849),L=n(33455),I=n(97957),R=n(86871),H=n(8676),M=n(37460),F=n(60560),N=n(87294),V=n(65867);const Z=new W.n({asset:B.Ct,weiAmount:0}),O=e=>{var t,n,r;let{recipient:s,onClose:o,nftItem:l,headerBlock:f,mainButton:x,multisigTTL:v}=e;const{standalone:y}=(0,c.bp)(),[w,C]=(0,a.useState)(!1),{t:T}=(0,d.$G)(),E=(0,F.IW)(),N=((e,t)=>{const{t:n}=(0,d.$G)(),i=(0,u._H)(),{api:r}=(0,c.bp)(),s=(0,j.Mu)(),a=(0,j.vz)(),o=(0,_.useQueryClient)();let l=null;return"ton-multisig"===s.type&&(l=(0,F.FX)(a,s).signerWallet),(0,_.useQuery)([I.S8.estimate,null===t||void 0===t?void 0:t.address,a,l],(async()=>{try{if("watch-only"===s.type)throw new Error("account not controllable");let n;if("ton-multisig"===s.type){let i=o.getQueryData([I.S8.multisigWallet,s.activeTonWallet.rawAddress]);i||(i=await new A.hqL(r.tonApiV2).getMultisigAccount({accountId:s.activeTonWallet.rawAddress})),n=await(0,k.zM)({api:r,multisig:i,hostWallet:l,recipient:t,nftAddress:e.address})}else n=await(0,k.uc)(r,s.activeTonWallet,t,e);return{fee:new W.n({asset:B.Ct,weiAmount:-1*n.event.extra}),payload:n}}catch(a){throw await(0,m.cB)(o,i,n,a),a}}),{enabled:null!=t})})(l,s),{mutateAsync:V,isLoading:O,error:D,reset:P}=((e,t,n,i)=>{const{t:r}=(0,d.$G)(),s=(0,u._H)(),{api:a}=(0,c.bp)(),o=(0,j.Mu)(),l=(0,_.useQueryClient)(),h=(0,L.BJ)(),p=(0,j.vz)(),{mutateAsync:f}=(0,H.Ug)(),{mutateAsync:x}=(0,j.x_)();return(0,_.useMutation)((async()=>{if("watch-only"===o.type)return console.error("Can't send a transfer using this account"),!1;if(!n)return!1;h("send-nft");try{if("ton-multisig"===o.type){let r=l.getQueryData([I.S8.multisigWallet,o.activeTonWallet.rawAddress]);r||(r=await new A.hqL(a.tonApiV2).getMultisigAccount({accountId:o.activeTonWallet.rawAddress}));const{signerWallet:c,signerAccount:u}=(0,F.FX)(p,o),d=await(0,R.TC)(s,u.id,f,{walletId:c.id}).catch((()=>null));if(!d)throw new Error("Signer not found");if(null===i||void 0===i||!i.multisigTTL)throw new Error("TTL is required");await(0,k.xo)({api:a,hostWallet:c,multisig:r,recipient:e,nftAddress:t.address,fee:n,signer:d,ttlSeconds:60*Number(i.multisigTTL)})}else{const i=await(0,R.TC)(s,o.id,f).catch((()=>null));if(null===i)return!1;await(0,k.Nq)(a,o,e,t,n,i)}}catch(c){await(0,m.cB)(l,s,r,c)}return await x(),!0}))})(s,l,null===(t=N.data)||void 0===t?void 0:t.payload,{multisigTTL:v}),Q=null===(n=l.previews)||void 0===n?void 0:n.find((e=>"100x100"===e.resolution)),$=async()=>{if(O)return!1;try{P();const e=await V();return e&&(C(!0),setTimeout(o,2e3)),e}catch(e){return console.error(e),!1}};return(0,i.jsx)(p.vD.Provider,{value:{recipient:s,assetAmount:Z,estimation:N,formState:{done:w,isLoading:O,error:D},onClose:()=>o(),onBack:()=>{},handleSubmit:$},children:(0,i.jsxs)(h.r4,{onSubmit:async e=>{e.stopPropagation(),e.preventDefault(),$()},standalone:y,children:[f,(0,i.jsxs)(M.kI,{children:[Q?(0,i.jsx)(M.Ee,{src:Q.url}):(0,i.jsx)(M.Ao,{}),(0,i.jsx)(M.DG,{children:null!==(r=l.dns)&&void 0!==r?r:l.metadata.name}),(0,i.jsx)(M.Dx,{children:T("txActions_signRaw_types_nftItemTransfer")})]}),(0,i.jsxs)(g.L8,{margin:!1,fullWidth:!0,children:[(0,i.jsx)(p.n_,{}),(0,i.jsx)(p.RB,{}),(0,i.jsx)(p.f1,{})]}),(0,i.jsx)(b,{nftItem:l}),(0,i.jsx)(S.Zv,{}),E&&v?(0,i.jsx)(G,{ttl:v}):null,x]})})},D=(0,V.zo)(N.G)(T||(T=(0,E.Z)(["\n    margin-bottom: 1rem;\n"]))),G=e=>{let{ttl:t}=e;const{data:n}=(0,F.F)(),{signerWallet:r}=(0,F.h3)();return n?(0,i.jsx)(D,{status:"progress",signedWallets:[],threshold:n.threshold,pendingWallets:n.signers,hostAddress:r.rawAddress,secondsLeft:60*Number(t)}):null};var P=n(77827);var Q=n(3182);const $=e=>{let{nftItem:t,onClose:n}=e;const h=(0,u._H)(),{t:x}=(0,d.$G)(),{standalone:v,extension:g}=(0,c.bp)(),y=(0,a.useRef)(null),w=(0,a.useRef)(null),b=(0,a.useRef)(null),[T,E]=(0,a.useState)(!0),[k,S]=(0,a.useState)(),W=(0,F.IW)(),{mutateAsync:B}=(0,f.gW)(),{mutateAsync:L,isLoading:I}=(()=>{const e=(0,u._H)(),{api:t}=(0,c.bp)(),n=(0,j.rT)(),{t:i}=(0,d.$G)(),r=(0,_.useQueryClient)();return(0,_.useMutation)((async()=>{const s=await new A.HOX(t.tonApiV2).getAccount({accountId:n.rawAddress});try{(0,P.$2)(s)}catch(a){await(0,m.cB)(r,e,i,a)}}))})(),R=async e=>{await L(),E(!0),S(e),Z("confirm")},H=(0,a.useCallback)((()=>{E(!1),S((e=>e?{...e,done:!1}:void 0)),Z("recipient")}),[S]),[M,N]=(0,a.useState)(),[V,Z]=(0,a.useState)(W?"multisig-settings":"recipient"),D=(0,a.useCallback)((async e=>{let{address:t}=e;const n={address:t},i=await B(n);R({address:{...n,blockchain:r.S.TON},toAccount:i,comment:"",done:!0})}),[R,B]),G=async e=>{const t=(0,s.p)({url:e});if(null===t)return h.uiEvents.emit("copy",{method:"copy",params:x("Unexpected_QR_Code")});await D(t)},$={"multisig-settings":y,recipient:w,confirm:b}[V];return(0,i.jsx)(m.im,{standalone:v,extension:g,children:(0,i.jsx)(o.Z,{childFactory:(0,m.mH)(T),children:(0,i.jsx)(l.Z,{nodeRef:$,classNames:"right-to-left",addEndListener:e=>{setTimeout(e,m.x9)},children:e=>(0,i.jsxs)("div",{ref:$,children:["multisig-settings"===V&&(0,i.jsx)(Q.d,{onSubmit:e=>{E(!0),N(e.lifetime),Z("recipient")},isAnimationProcess:"exiting"===e,Header:()=>(0,i.jsx)(m.io,{title:x("multisig_create_order_title"),onClose:n}),MainButton:m.c7}),"recipient"===V&&(0,i.jsx)(f.Aq,{data:k,setRecipient:R,onScan:G,isExternalLoading:I,acceptBlockchains:[r.S.TON],MainButton:m.c7,HeaderBlock:()=>(0,i.jsx)(m.ap,{title:x("nft_transfer_title"),onClose:n,onBack:W?H:void 0})}),"confirm"===V&&(0,i.jsx)(O,{onClose:n,recipient:k,nftItem:t,mainButton:(0,i.jsx)(p.uq,{MainButton:m.y8}),headerBlock:(0,i.jsx)(C,{onBack:H,onClose:n}),multisigTTL:M})]})},V)})})},q=()=>{const e=(0,u._H)(),[t,n]=(0,a.useState)(),r=(0,a.useCallback)((()=>{n(void 0)}),[n]);(0,a.useEffect)((()=>{const t=e=>{n(e.params)};return e.uiEvents.on("transferNft",t),()=>{e.uiEvents.off("transferNft",t)}}),[]);const s=(0,a.useCallback)((()=>{if(t)return(0,i.jsx)($,{onClose:r,nftItem:t})}),[t,r]);return(0,i.jsx)(h.P_,{isOpen:!!t,handleClose:r,hideButton:!0,backShadow:!0,children:s})}},4959:(e,t,n)=>{n.d(t,{Z:()=>p});var i=n(9116),r=n(29580);var s=n(61174),a=n(72791),o=n(99172);function l(e,t){var n=Object.create(null);return e&&a.Children.map(e,(function(e){return e})).forEach((function(e){n[e.key]=function(e){return t&&(0,a.isValidElement)(e)?t(e):e}(e)})),n}function c(e,t,n){return null!=n[t]?n[t]:e.props[t]}function u(e,t,n){var i=l(e.children),r=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var i,r=Object.create(null),s=[];for(var a in e)a in t?s.length&&(r[a]=s,s=[]):s.push(a);var o={};for(var l in t){if(r[l])for(i=0;i<r[l].length;i++){var c=r[l][i];o[r[l][i]]=n(c)}o[l]=n(l)}for(i=0;i<s.length;i++)o[s[i]]=n(s[i]);return o}(t,i);return Object.keys(r).forEach((function(s){var o=r[s];if((0,a.isValidElement)(o)){var l=s in t,u=s in i,d=t[s],h=(0,a.isValidElement)(d)&&!d.props.in;!u||l&&!h?u||!l||h?u&&l&&(0,a.isValidElement)(d)&&(r[s]=(0,a.cloneElement)(o,{onExited:n.bind(null,o),in:d.props.in,exit:c(o,"exit",e),enter:c(o,"enter",e)})):r[s]=(0,a.cloneElement)(o,{in:!1}):r[s]=(0,a.cloneElement)(o,{onExited:n.bind(null,o),in:!0,exit:c(o,"exit",e),enter:c(o,"enter",e)})}})),r}var d=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},h=function(e){function t(t,n){var i,r=(i=e.call(this,t,n)||this).handleExited.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i));return i.state={contextValue:{isMounting:!0},handleExited:r,firstRender:!0},i}(0,s.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},t.getDerivedStateFromProps=function(e,t){var n,i,r=t.children,s=t.handleExited;return{children:t.firstRender?(n=e,i=s,l(n.children,(function(e){return(0,a.cloneElement)(e,{onExited:i.bind(null,e),in:!0,appear:c(e,"appear",n),enter:c(e,"enter",n),exit:c(e,"exit",n)})}))):u(e,r,s),firstRender:!1}},n.handleExited=function(e,t){var n=l(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var n=(0,r.Z)({},t.children);return delete n[e.key],{children:n}})))},n.render=function(){var e=this.props,t=e.component,n=e.childFactory,r=(0,i.Z)(e,["component","childFactory"]),s=this.state.contextValue,l=d(this.state.children).map(n);return delete r.appear,delete r.enter,delete r.exit,null===t?a.createElement(o.Z.Provider,{value:s},l):a.createElement(o.Z.Provider,{value:s},a.createElement(t,r,l))},t}(a.Component);h.propTypes={},h.defaultProps={component:"div",childFactory:function(e){return e}};const p=h}}]);
//# sourceMappingURL=221.4aae891a.chunk.js.map